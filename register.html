<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ลงทะเบียนพนักงาน</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
	<style>
      
	
        .dis{
            background-color: #EAF0FE;
            color: 1f3d77;
            border: none;
}
       
        .card{
            background: #fff;
            
            border: 1px solid #EAF0FE;
         
        }
        .input-group{
            display: flex;
            justify-content: center;
        }
       
        .btn {
            color: #ffffff;
            background-color: #1f3d77;
        }

        .input-icons span {
            position: absolute;
            padding: 12px;
            color: #1f3d77;
        }
         
        .input-icons {
            width: 100%;
            margin-bottom: 10px;
        }
         
      
        .input-field {
            width: 100%;
            text-align: left;
            border: 1px solid #EAF0FE;
            border-radius: 5px;
            padding: 10px 5px 10px 45px;
        }
        .title {
            padding: 0 0 20px  0;
            font-weight: bold;
            color: #1f3d77;
        }
	</style>
</head>
<body>
    <div class="container mt-3">
        <div class="card p-5">
            <div class="title">ลงทะเบียนพนักงาน</div>

            <div class="input-icons pb-2">
                <span class="material-symbols-outlined"> account_circle </span>
                <input type="text" class="input-field dis" id="displayName" placeholder="Line " name="displayName" readonly />
            </div>          	
            <div class="input-icons pb-2">
                <span class="material-symbols-outlined"> signature </span>
                <input type="text" class="input-field dis" id="userId" placeholder="LineID"   name="userId" readonly/>
            </div>	
            <br>
            <div class="input-icons pb-2">
                <span class="material-symbols-outlined"> co_present </span>
                <input type="text" class="input-field"  id="nameId" placeholder="ชื่อ - สกุล"   name="nameId"/>
            </div>
            <div class="input-icons pb-2">
                <span class="material-symbols-outlined">badge</span>
                <input type="text" class="input-field" id="numberId" placeholder="รหัสพนักงาน"   name="numberId" >
            </div>
            <div class="input-icons pb-2">
                <span class="material-symbols-outlined">  patient_list </span>
                <input type="text" class="input-field" id="roleId" placeholder="ตำแหน่ง"   name="roleId" >
            </div>
            <br>
            <!-- Add this input field to your form -->
		<div class="input-icons pb-2">
		    <span class="material-symbols-outlined"> photo_camera </span>
		    <input type="file" class="input-field" id="imageInput" name="imageInput" accept="image/*" onchange="previewImage(this)">
		</div>
		
		<!-- Add an image preview container if needed -->
		<div id="imagePreviewContainer"></div>
            <br>
            <button id="submitButton" class="btn input-field" onclick="submitForm()">บันทึกข้อมูล</button>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script>
	
        window.onload = function () {
            initializeLiff(), getUserProfile();
        };

        async function initializeLiff() {
            await liff.init({ liffId: '2002689552-4R7VpE2W' });

            if (liff.isLoggedIn()) {
                getUserProfile();
            } else {
                liff.login();
            }
        }

        async function getUserProfile() {
            try {
                const profile = await liff.getProfile();
                document.getElementById('userId').value = profile.userId;
                document.getElementById('displayName').value = profile.displayName;
            } catch (error) {
                console.error('Error getting profile data:', error);
            }
        }
	 function previewImage(input) {
            var previewContainer = document.getElementById('imagePreviewContainer');
            previewContainer.innerHTML = '';

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    var previewImage = document.createElement('img');
                    previewImage.setAttribute('src', e.target.result);
                    previewImage.setAttribute('alt', 'Image Preview');
                    previewImage.setAttribute('style', 'max-width: 100%; max-height: 200px;');
                    previewContainer.appendChild(previewImage);
                };

                reader.readAsDataURL(input.files[0]);
            }
        }

        function submitForm() {
            document.getElementById('submitButton').disabled = true;
		
            let obj = {
                userID: userId.value,
                nameID: nameId.value,
                numberID: numberId.value,
                roleID: roleId.value,
                imageInput: imageInput.value
            };

            fetch("https://script.google.com/macros/s/AKfycbwdTMs9dR9JcdC3Yf0dYrqDG9TjCP9iA7LduFwzDkDWko8zEvDjuvsw_cP3KBLGX12P/exec", {
                method: "POST",
                body: JSON.stringify(obj),
            })
            .then(response => response.text())
            .then(data => {
                Swal.fire({
                    title: 'สำเร็จ!',
                    text: 'บันทึกข้อมูลของคุณเรียบร้อย!',
                    icon: 'success',
                    confirmButtonText: 'ปิด',
                }).then(() => {
                    sendFlexMessage();
                    console.log(data);
                });
            })
            .catch(error => {
                Swal.fire({
                    title: 'Error!',
                    text: 'Form submission failed. Please try again.',
                    icon: 'error',
                    confirmButtonText: 'OK',
                }).then(() => {
                    document.getElementById('submitButton').disabled = false;
                });

                console.error(error);
            });
        }  
     </script>
	 <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
     <script>
         async function initializeLiff() {
         await liff.init({ liffId: '2002689552-4R7VpE2W' });
 
         if (liff.isLoggedIn()) {
             getUserProfile();
         } else {
             liff.login();
         }
     }
 
     async function sendFlexMessage() {
    const flexMessage = {
        type: 'flex',
        altText: 'ลงทะเบียนเรียบร้อย', // Change altText value here
        contents: {
            type: 'bubble',
            body: {
                type: 'box',
                layout: 'vertical',
                contents: [
                    {
                        type: 'text',
                        text: 'ลงทะเบียนเรียบร้อย!',
                        weight: 'bold',
                        size: 'lg',
                        wrap: true,
                    },
                    // Add more content as needed
                ],
            },
        },
    };

    await liff.sendMessages([flexMessage]);
    liff.closeWindow();
}

	</script>
</body>
</html>
